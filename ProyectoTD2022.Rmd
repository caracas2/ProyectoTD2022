---
title: "ProyectoTD2022"
author: ' Carles Vicent Adam Castañer, Ana González Mandler, Arnau Monzó Ferragut,
  Ivan Alexandrov y Amparo Galvez Vilar. GRUPO F'
output:
  html_document:
    df_print: paged
---

Lo primero que haremos será llamar a todas las librerías necesarias que vamos a utilizar en este trabajo.

```{r}
# Especificamos las librerías necesarias en esta lista
packages = c("stringr", "ggplot2","tidyr","dplyr","readr", "plotly")# use this function to check if each package is on the local machine
# if a package is installed, it will be loaded
# if any are not, the missing package(s) will be installed and loaded
package.check <- lapply(packages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE,repos='http://cran.rediris.es')
    library(x, character.only = TRUE)
  }
})
# verify they are loaded
search()

```

Posteriormente cargamos los 14 ficheros de datos

```{r}
files <- list.files(path = "data/", full.names = T, pattern = "csv", recursive = TRUE)

```

Fusionamos los datos en un único data frame

```{r}
for (file in files){

      

  # if the merged dataset doesn't exist, create it

  if (!exists("dataset")){

    dataset <- read.table(file, header=TRUE, sep=",")

  }

  

  # if the merged dataset does exist, append to it

  if (exists("dataset")){

    temp_dataset <-read.table(file, header=TRUE, sep=",")

    dataset<-rbind(dataset, temp_dataset)

    rm(temp_dataset)

  }

}
```

Acondicionamos los datos para que se correspondan con un tidy dataset.

```{r}
df <- dataset %>% pivot_longer(cols = starts_with("LA"), names_to = "Periodo", values_to = "Valores", names_prefix = "/")

df$dateObserved <- as.Date(df$dateObserved)
```

Eliminamos columnas que son irrelevantes para este proyecto

```{r}
df <- df %>% select(-c(ï.._id, fiwareServicePath, entityType, recvTime))

```

Cambiamos el nombre de las columnas recvTime y dateObservation para que sea mas fácil realizar las siguientes operaciones.

```{r}
df <- df %>% rename(FechaObservacion = dateObserved) %>% rename(IdEntidad = entityId)

df_tidy <- df %>%  
   
  mutate(IdEntidad = ifelse(IdEntidad == "T248677-daily" , "VivChafCadz", IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248671-daily" , " Cadiz16 ", IdEntidad))%>%
  mutate(IdEntidad = ifelse(IdEntidad == "T248670-daily" , "CarlCervChaf", IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248655-daily", "Cadiz3 ", IdEntidad))%>%
  mutate(IdEntidad = ifelse(IdEntidad == "T248678-daily" , "CarlCerv34 ", IdEntidad)) %>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248682-daily" , "Cuba3", IdEntidad)) %>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248682-daily" , "Cuba3", IdEntidad)) %>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248669-daily" , "DoctorSerrano21", IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248676-daily" , "SalvAbrilChaf", IdEntidad))%>% 
  mutate(IdEntidad= ifelse(IdEntidad == "T248683-daily", "Sueca2" , IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248680-daily", "Sueca32", IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248652-daily","SuecaEsqDenia",  IdEntidad))%>% 
  mutate(IdEntidad = ifelse(IdEntidad == "T248684-daily","Sueca61", IdEntidad))%>%
  mutate(IdEntidad = ifelse(IdEntidad == "T248672-daily" , "PuertoRico21", IdEntidad))%>%
  mutate(IdEntidad = ifelse(IdEntidad == "T248661-daily" , "GeneralPrim",  IdEntidad))
```

A continuacíon hemos planteado 7 preguntas las cuales más adelante responderemos.

## PREGUNTAS PROPUESTAS

1.  ¿Que calle es la mas ruidosa? ¿Y la que menos?

2.  ¿Que mes del año tiene el maximo indice de ruido? ¿Y el minimo?

3.  Calcula la media de los dos meses del anterior apartado.

4.  ¿Como afecto el confinamiento?

5.  ¿Como varía el ruido dependiendo de si es lunes o sábado?
